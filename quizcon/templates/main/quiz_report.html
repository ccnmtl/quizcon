{% extends 'base.html' %}
{% load quiz_tools %}

{% block title %}
Report for {{ quiz.title }}
{% endblock %}

{% block content %}
    {% if submissions %}
    <div class="container-fluid p-0">
        <div class="row mb-2 mb-xl-3">
            <div class="col-auto d-none d-sm-block">
                <h3>{{quiz.title}} Analytics</h3>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-sm-6 col-xxl-4 d-flex">
                <div class="card illustration flex-fill">
                    <div class="card-body p-0 d-flex flex-fill">
                        <div class="row g-0 w-100">
                            <div class="col">
                                <div class="illustration-text p-3 m-1">
                                    <h4 class="illustration-text">Welcome to your Quiz dashboard!</h4>
                                    <p class="mb-0">Here you will find stats about your quiz.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-xxl-4 d-flex">
                <div class="card illustration flex-fill">
                    <div class="card-body p-0 d-flex flex-fill">
                        <div class="row g-0 w-100">
                            <div class="col">
                                <div class="illustration-text p-3 m-1">
                                    <h3 class="illustration-text">Quiz Details</h3>
                                    <p class="mb-0">
                                        <ul>
                                        <!-- {% if quiz.randomize %} Questions are randomized.<br>{% endif %} -->
                                            <li>Quiz has {{quiz.question_set.count}} questions.</li>
                                            <li>The scoring scheme for this Quiz is {{quiz.scoring_scheme_verbose}}.</li>
                                            <li>Students will be able to see their answers: <strong>{{quiz.show_answers_verbose|lower}} </strong> {% if quiz.show_answers == 2 %}{{quiz.show_answers_date}}{% endif %}</li>
                                        </ul>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-xxl-4 d-flex">
                <div class="card illustration flex-fill">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-center">
                            <div class="flex-grow-1 text-center">
                                <h3 class="mb-2 illustration-text">Total Quiz Submissions</h3>
                                <p class="mt-3 h3">{{total_submissions}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-sm-6 col-xxl-2 d-flex">
                <div class="card flex-fill">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-start">
                            <div class="flex-grow-1 text-center">
                            {% submission_mean submissions as mean %}
                                <h3 class="mb-2">{{mean}}</h3>
                                <p class="mb-2">Mean Score</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-xxl-2 d-flex">
                <div class="card flex-fill">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-start">
                            <div class="flex-grow-1 text-center">
                            {% submission_mode submissions as mode %}
                                <h3 class="mb-2">{{mode}}</h3>
                                <p class="mb-2">Mode</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-xxl-2 d-flex">
                <div class="card flex-fill">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-start">
                            <div class="flex-grow-1 text-center">
                            {% submission_standard_dev submissions as stdev %}
                                <h3 class="mb-2">{{stdev}}</h3>
                                <p class="mb-2">Standard Deviation</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-xxl-2 d-flex">
                <div class="card flex-fill">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-start">
                            <div class="flex-grow-1 text-center">
                            {% submission_median submissions as median %}
                                <h3 class="mb-2">{{median}}</h3>
                                <p class="mb-2">Median</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-xxl-2 d-flex">
                <div class="card flex-fill">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-start">
                            <div class="flex-grow-1 text-center">
                            {% submission_max_points submissions as max %}
                                <h3 class="mb-2">{{max}}</h3>
                                <p class="mb-2">Maximum Points Earned</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-xxl-2 d-flex">
                <div class="card flex-fill">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-start">
                            <div class="flex-grow-1 text-center">
                            {% submission_min_points submissions as min %}
                                <h3 class="mb-2">{{min}}</h3>
                                <p class="mb-2">Minimum Points Earned</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-lg-8 d-flex">
                <div class="card flex-fill w-100">
                    <div class="card-header">
                        <div class="card-actions text-muted float-end">
                            {{quiz.title}}
                        </div>
                        <h5 class="card-title mb-0">Per Question Analysis</h5>
                    </div>
                    <div class="card-body">
                        <p class="h4"><u>Questions with the most right answers:</u></p>
                        {% right_answers_per_quiz quiz.id as question_most_right %}
                        <ul>
                        {% for question in question_most_right %}
                            <li>{{question.text|safe}}</li>
                        {% endfor %}
                        </ul>
                        <p class="h4"><u>Questions with the most wrong answers:</u></p>
                        {% wrong_answers_per_quiz quiz.id as question_most_wrong %}
                        <ul>
                        {% for question in question_most_wrong %}
                            <li>{{question.text|safe}}</li>
                        {% endfor %}
                        </ul>
                        <p class="h4"><u>Questions with the most “I don’t know” answers:</u></p>
                        {% idk_answers_per_quiz quiz.id as question_most_idk %}
                        <ul>
                        {% for question in question_most_idk %}
                            <li>{{question.text|safe}}</li>
                        {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-4 d-flex">
                <div class="card flex-fill w-100">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Percentage of Submissions For Each Option</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-start">
                            <div class="percent-container">
                                {% for question in quiz.question_set.all %}
                                    <div class="choicebox float-end mb-2">
                                    {% for x in num_markers %}
                                    {% percentage_choice x question as percent%}
                                        <div class="form-check answer{{x}}">
                                            <span class="text-white bg-dark">({{percent}}%)</span>
                                        </div>
                                    {% endfor %}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
        <p>No submissions for this quiz yet.</p>
    {% endif %}
{% endblock %}
